<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Proposal for Industrial Air Cooling - Five Star Technologies</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: Arial, sans-serif;
        line-height: 1.6;
        color: #333;
        background-color: #ffffff;
      }

      .header {
        background: white;
        text-align: left;
        flex-shrink: 0;
        padding: 12px 24px !important;
      }

      .company-name {
        font-size: 24px;
        font-weight: bold;
        color: #2c3e50;
      }

      .tagline,
      .contact,
      .website {
        font-size: 11px;
        color: #000000;
        font-weight: 600;
      }

      .company-desc {
        padding: 12px 0 !important;
        font-size: 13px;
        color: #000000;
        padding: 5px 10px;
        background: #ffffff;
        font-weight: 600;
      }

      .document-header {
        border-radius: 6px;
        border: 1px solid #000000;
        background: #ffffff;
        color: #000000;
        padding: 4px;
        text-align: center;
        flex-shrink: 0;
      }

      .document-title {
        font-size: 16px;
        font-weight: bold;
      }

      .content {
        flex: 0.95;
        /* padding: 24px 24px !important; */
        overflow-y: auto;
      }

      .footer {
        background: white;
        border-top: 2mm solid #e74c3c;
        padding: 10mm 20mm;
        text-align: center;
        font-size: 11px;
        color: #7f8c8d;
        flex-shrink: 0;
      }

      .footer-company {
        font-weight: bold;
        color: #2c3e50;
        font-size: 12px;
        margin-bottom: 3px;
      }

      .footer-tagline {
        font-size: 9px;
        color: #95a5a6;
        margin-bottom: 2px;
      }

      .footer-services {
        font-size: 9px;
        color: #95a5a6;
      }

      .ref-date {
        display: flex;
        justify-content: space-between;
        margin-bottom: 15px;
        font-size: 12px;
      }

      .ref-date div {
        background: #ffffff;
        padding: 6px 0;
        border-radius: 4px;
      }

      .recipient {
        background: #ffffff;
        margin-bottom: 15px;
        font-size: 12px;
      }

      .subject {
        background: #ffffff;
        margin-bottom: 24px;
      }

      .subject strong {
        color: #000000;
      }

      .subject .subject-text {
        font-weight: bold;
        text-decoration: underline;
        text-decoration-skip-ink: none;
        color: #000000;
        margin-bottom: 12px;
        font-size: 16px;
      }

      .intro {
        margin-bottom: 20px;
        text-align: justify;
        font-size: 12px;
      }

      .intro p {
        margin-bottom: 10px;
      }

      .quotation-table {
        width: 100%;
        border-collapse: collapse;
        margin: 15px 0;
        background: white;
        box-shadow: 0 1px 5px rgba(0, 0, 0, 0.1);
      }

      .quotation-table th {
        background: #3498db;
        color: white;
        padding: 8px 6px;
        text-align: left;
        font-weight: bold;
        font-size: 10px;
      }

      .quotation-table td {
        padding: 6px 6px;
        border-bottom: 1px solid #ddd;
        font-size: 10px;
      }

      .product-image {
        width: 60px;
        height: 45px;
        object-fit: cover;
        border-radius: 4px;
        border: 1px solid #ddd;
      }

      .product-cell {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .product-info {
        display: flex;
        flex-direction: column;
      }

      .product-name {
        font-weight: bold;
        font-size: 10px;
      }

      .quotation-table tr:nth-child(even) {
        background: #f8f9fa;
      }

      .total-row {
        font-weight: bold;
      }

      .total-row td {
        border-bottom: none;
      }

      .currency {
        font-family: monospace;
        font-weight: bold;
      }

      .important-note {
        text-align: justify;
        font-size: 12px;
      }

      .important-note ul li {
        margin-bottom: 12px;
      }

      .note {
        background: #ffffff;
        margin: 10px 0;
        border-radius: 4px;
        font-size: 11px;
        text-decoration: underline;
      }

      .section-title {
        background: #34495e;
        color: white;
        padding: 8px 12px;
        margin: 15px 0 10px 0;
        font-weight: bold;
        font-size: 12px;
      }

      .billing-info {
        background: #f8f9fa;
        padding: 12px;
        border-radius: 4px;
        margin: 10px 0;
        font-size: 11px;
      }

      .terms-list {
        text-align: justify;
        font-size: 12px;
      }

      .sub-terms {
        margin-top: 8px;
        padding-left: 15px;
      }

      .sub-terms > div {
        margin-bottom: 6px;
        position: relative;
        padding-left: 12px;
        font-size: 10px;
      }

      .sub-terms > div::before {
        content: "•";
        position: absolute;
        left: 0;
        color: #3498db;
        font-weight: bold;
      }

      .important-note,
      .billing,
      .terms {
        margin-top: 48px;
      }

      .signature {
        margin-top: 20px;
        text-align: left;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 4px;
        font-size: 11px;
      }

      /* Override any inline styles in signature content */
      .signature * {
        font-size: 11px !important;
        font-weight: normal !important;
        color: #333 !important;
      }

      /* Ensure phone numbers don't appear larger */
      .signature span,
      .signature div,
      .signature p {
        font-size: 11px !important;
        font-weight: normal !important;
      }

      .signature-line {
        margin-top: 30px;
        border-top: 1px solid #333;
        width: 150px;
        padding-top: 8px;
      }

      @media print {
        @page {
          margin: 40mm 10mm;
        }

        @page {
          @top-center {
            content: element(header);
          }
          @bottom-center {
            content: element(footer);
          }
        }

        body {
          margin: 0;
          padding: 0;
          background: white;
        }

        .header {
          position: running(header);
        }

        .footer {
          position: running(footer);
        }
      }


      @media (max-width: 768px) {
        .content {
          /* padding: 10mm; */
        }

        .header {
          padding: 10mm;
        }

        .footer {
          padding: 10mm;
        }

        .quotation-table {
          font-size: 9px;
        }

        .quotation-table th,
        .quotation-table td {
          padding: 4px 3px;
        }

        .ref-date {
          flex-direction: column;
          gap: 8px;
        }
      }

      .header {
  background: white;
  padding: 12px 24px 0 24px !important;
}
.header-row {
  display: flex;
  align-items: flex-start;
  gap: 18px;
}
.logo-col {
  flex: 0 0 80px;
  display: flex;
  align-items: flex-start;
  justify-content: center;
}
.company-logo {
  width: 60px;
  height: auto;
  margin-top: 2px;
}
.info-col {
  flex: 1;
}
.company-name {
  font-size: 24px;
  font-weight: bold;
  color: #222;
  margin-bottom: 2px;
}
.contact-details {
  font-size: 8px;
  color: #111;
  margin-bottom: 2px;
}
.company-desc {
  font-size: 10px;
  color: #003366;
  font-weight: bold;
  margin-top: 8px;
  margin-bottom: 0;
  letter-spacing: 0.5px;
}
    </style>
  </head>
  <body>
    <!-- Page 1 -->
    <div class="page">
      <div class="content">
        <div class="document-header">
          <div class="document-title">PROPOSAL FOR <%= quotation.title %></div>
        </div>

        <div class="proposal-details">
          <div class="ref-date">
            <div><strong>Ref.No.:</strong> <%= quotation.quotationRefNumber  %></div>
            <div><strong>Date:</strong> <%= new Date(quotation.createdAt).toLocaleDateString('en-GB') %></div>
          </div>

          <div class="recipient">
            <strong>To:</strong><br />
            <%= client.name %><br />
            <%= client.position %><br />
            <%= client.companyName %>
            <%= client.address %> <br/>
            <%= client.city %> <%= client.PIN %> <br/>
          </div>

          <% if (quotation.subject && quotation.subject.length > 0) { %>
          <div class="subject">
            <div class="subject-text">
              <strong>Subject:</strong> <%= quotation.subject %><br />
            </div>
          </div>
          <% } %>

          <% if (quotation.formalMessage && quotation.formalMessage.length > 0) { %>
          <p>
              <div class="intro">
              <span><strong>Dear Sir,</strong></span>
              <%- quotation.formalMessage %>
            </div>
          </p>
          <% } %>

          <% if (quotation.products && quotation.products.length > 0) { %>
            <table class="quotation-table">
              <thead>
                <tr>
                  <th style="background-color:#34495e;">Sr. No</th>
                  <th style="background-color:#34495e;">Image</th>
                  <th style="background-color:#34495e;">Model</th>
                  <th style="background-color:#34495e;">Specification</th>
                  <th style="background-color:#34495e;">Unit</th>
                  <th style="background-color:#34495e;">Quantity</th>
                  <th style="background-color:#34495e;">Price</th>
                  <th style="background-color:#34495e;">Total</th>
                </tr>
              </thead>
              <tbody>
                <% quotation.products.forEach((item, index) => { %>
                  <tr style="height:auto; vertical-align:top;">
                    <td><%= index + 1 %></td>
                    <td>
                      <% if (item.image) { %>
                        <img src="<%= item.image %>" alt="<%= item.title || 'Product' %>" class="product-image" style="max-width:80px; max-height:60px; object-fit:contain;" />
                      <% } else { %>
                        <img src="https://via.placeholder.com/80x60?text=No+Image" alt="No Image" class="product-image" style="max-width:80px; max-height:60px; object-fit:contain;" />
                      <% } %>
                    </td>
                    <td><%= item.model || '-' %></td>
                    <td style="white-space:pre-line; max-width:300px; word-break:break-word;"> <%= item.specification || '-' %> </td>
                    <td><%= item.unit || '-' %></td>
                    <td><%= item.quantity || '-' %></td>
                    <td class="currency">₹ <%= item.price || '0' %></td>
                    <td class="currency">₹ <%= item.total || '0' %></td>
                  </tr>
                <% }); %>
                
                <% if (quotation.machineInstallation) { %>
                  <tr style="height:auto; vertical-align:top;">
                    <td><%= quotation.products.length + 1 %></td>
                    <td>-</td>
                    <td>Machine Installation</td>
                    <td style="white-space:pre-line; max-width:300px; word-break:break-word;">Machine Installation Services</td>
                    <td><%= quotation.machineInstallation.unit || '-' %></td>
                    <td><%= quotation.machineInstallation.quantity || '-' %></td>
                    <td class="currency">₹ <%= quotation.machineInstallation.price || '0' %></td>
                    <td class="currency">₹ <%= quotation.machineInstallation.total || '0' %></td>
                  </tr>
                <% } %>
                <tr class="total">
                  <td colspan="7"><strong>(A) Total Amount</strong></td>
                  <td class="currency"><strong>₹ <%= quotation.totalAmount ? quotation.totalAmount.toLocaleString('en-IN') : '0' %></strong></td>
                </tr>
                <% if (quotation.GST) { 
                     const gstPercentage = quotation.gstPercentage || 18;
                     const gstAmount = Math.round((quotation.totalAmount || 0) * (gstPercentage / 100));
                     const grandTotal = (quotation.totalAmount || 0) + gstAmount;
                %>
                <tr class="total-row">
                  <td colspan="7"><strong>GST (<%= gstPercentage %>%)</strong></td>
                  <td class="currency"><strong>₹ <%= gstAmount.toLocaleString('en-IN') %></strong></td>
                </tr>
                <tr class="total-row">
                  <td colspan="7"><strong>Grand Total (Incl. GST)</strong></td>
                  <td class="currency"><strong>₹ <%= grandTotal.toLocaleString('en-IN') %></strong></td>
                </tr>
                <% } %>
              </tbody>
            </table>

            <div class="note"><strong>Note:</strong> GST & Freight Extra</div>
          <% } else { %>
            <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 4px; margin: 15px 0;">
              <p style="font-size: 14px; color: #666;">No products added to this quotation.</p>
            </div>
          <% } %>
        </div>

        <% 
        // Filter products that have notes
        const productsWithNotes = quotation.products.filter(product => product.notes && product.notes.trim() !== '');
        %>
        <% if (productsWithNotes.length > 0) { %>
          <div class="important-note">
            <div class="section-title">Product Notes</div>
            <div style="margin-left: 20px; text-align: justify; font-size: 12px;">
              <% productsWithNotes.forEach((product, index) => { %>
                <div style="margin-bottom: 15px;">
                  <strong><%= index + 1 %>. <%= product.title || product.model || 'Product' %></strong><br/>
                  <div style="margin-left: 20px; margin-top: 5px;">
                    <%- product.notes %>
                  </div>
                </div>
              <% }); %>
            </div>
          </div>
        <% } %>

        <% 
        // Filter products that have terms and conditions
        const productsWithTerms = quotation.products.filter(product => product.termsAndConditions && product.termsAndConditions.trim() !== '');
        %>
        <% if (productsWithTerms.length > 0) { %>
          <div class="important-note">
            <div class="section-title">Product Terms & Conditions</div>
            <div style="margin-left: 20px; text-align: justify; font-size: 12px;">
              <% productsWithTerms.forEach((product, index) => { %>
                <div style="margin-bottom: 15px;">
                  <strong><%= index + 1 %>. <%= product.title || product.model || 'Product' %></strong><br/>
                  <div style="margin-left: 20px; margin-top: 5px;">
                    <%- product.termsAndConditions %>
                  </div>
                </div>
              <% }); %>
            </div>
          </div>
        <% } %>

        <% if (quotation.notes && quotation.notes.trim() !== '') { %>
          <div class="important-note">
            <div class="section-title">General Notes</div>
            <div style="margin-left: 20px; text-align: justify; font-size: 12px;">
              <%- quotation.notes %>
            </div>
          </div>
          <% } %>

        <% if (quotation.billingDetails) { %>
          <div class="billing">
            <div class="section-title">Billing Point</div>
            <div class="billing-info">
              <strong>Material will be billed through</strong><br />
              <%- quotation.billingDetails %>
            </div>
          </div>
        <% } %>

        <% if (quotation.supply || quotation.installationAndCommissioning) { %>
        <div class="terms">
          <div class="section-title">General Terms & Conditions</div>
          <div class="terms-list">
            <% if (quotation.supply) { %>
              <div>
                <strong>Supply</strong> - <%= quotation.supply %><br />
              </div>
            <% } %>
            <% if (quotation.installationAndCommissioning) { %>
              <div>
                <strong>I&C</strong> - <%= quotation.installationAndCommissioning %>.
              </div>
            <% } %>
            
            <% if (quotation.termsAndConditions && quotation.termsAndConditions.trim() !== '') { %>
              <%- quotation.termsAndConditions %>
            <% } %>
          </div>
        </div>
        <% } %>
        

         <!-- Related Products Table -->
         <% if (quotation.relatedProducts && quotation.relatedProducts.length > 0) { %>
           <div class="section-title">Related Products</div>
           <table class="quotation-table">
             <thead>
               <tr>
                 <th style="background-color:#34495e;">Model</th>
                 <th style="background-color:#34495e;">Image</th>
                 <th style="background-color:#34495e;">Specification</th>
               </tr>
             </thead>
             <tbody>
               <% quotation.relatedProducts.forEach(function(prod) { %>
                 <tr>
                   <td><%= prod.model || '-' %></td>
                   <td>
                     <img
                       src="<%= prod.image || 'https://via.placeholder.com/80x60?text=No+Image' %>"
                       class="product-image"
                       alt="<%= prod.model || 'Product' %>"
                       style="max-width:80px; max-height:60px; object-fit:contain;"
                     />
                   </td>
                   <td style="white-space:pre-line; max-width:300px; word-break:break-word;"><%= prod.specification || '-' %></td>
                 </tr>
               <% }); %>
             </tbody>
           </table>
         <% } %>
 
         <!-- Suggested Products Table -->
         <% if (quotation.suggestedProducts && quotation.suggestedProducts.length > 0) { %>
           <div class="section-title">Suggested Products</div>
           <table class="quotation-table">
             <thead>
               <tr>
                 <th style="background-color:#34495e;">Model</th>
                 <th style="background-color:#34495e;">Image</th>
                 <th style="background-color:#34495e;">Specification</th>
               </tr>
             </thead>
             <tbody>
               <% quotation.suggestedProducts.forEach(function(prod) { %>
                 <tr>
                   <td><%= prod.model || '-' %></td>
                   <td>
                     <img
                       src="<%= prod.image || 'https://via.placeholder.com/80x60?text=No+Image' %>"
                       class="product-image"
                       alt="<%= prod.model || 'Product' %>"
                       style="max-width:80px; max-height:60px; object-fit:contain;"
                     />
                   </td>
                   <td style="white-space:pre-line; max-width:300px; word-break:break-word;"><%= prod.specification || '-' %></td>
                 </tr>
               <% }); %>
             </tbody>
           </table>
         <% } %>
         
        <% if (quotation.signatureImage) { %>
          <div class="signature">
            <%- quotation.signatureImage %>
          </div>
        <% } %>
      </div>
    </div>
  </body>
</html> 